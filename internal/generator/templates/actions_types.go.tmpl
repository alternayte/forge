// Code generated by forge generate. DO NOT EDIT.

package actions

import (
	"context"

	"github.com/jackc/pgx/v5"
	"github.com/jackc/pgx/v5/pgconn"
)

// DB defines the database interface required by action implementations.
// This matches the pgx pool interface methods used for queries and transactions.
type DB interface {
	// QueryRow executes a query that returns at most one row.
	QueryRow(ctx context.Context, sql string, args ...any) pgx.Row

	// Query executes a query that returns rows.
	Query(ctx context.Context, sql string, args ...any) (pgx.Rows, error)

	// Exec executes a query without returning any rows.
	Exec(ctx context.Context, sql string, args ...any) (pgconn.CommandTag, error)

	// Begin starts a transaction. Required for transactional job enqueueing (JOBS-02).
	Begin(ctx context.Context) (pgx.Tx, error)
}

// CreateValidator is an optional interface that action implementations can implement
// to provide custom validation logic for create operations.
// If implemented, the ValidateCreate method will be checked via type assertion
// in overridden action methods.
type CreateValidator interface {
	ValidateCreate(ctx context.Context, input any) error
}

// UpdateValidator is an optional interface that action implementations can implement
// to provide custom validation logic for update operations.
// If implemented, the ValidateUpdate method will be checked via type assertion
// in overridden action methods.
type UpdateValidator interface {
	ValidateUpdate(ctx context.Context, id any, input any) error
}

// Registry stores action implementations by resource name for explicit registration
// at application startup. This replaces init() magic with explicit wiring.
type Registry struct {
	actions map[string]any
}

// NewRegistry creates a new empty action registry.
func NewRegistry() *Registry {
	return &Registry{
		actions: make(map[string]any),
	}
}

// Register stores an action implementation for a resource name.
// The action parameter should be a concrete type implementing a resource-specific Actions interface.
func (r *Registry) Register(name string, action any) {
	r.actions[name] = action
}

// Get retrieves an action implementation by resource name.
// Returns the action and true if found, nil and false otherwise.
// Use GetTyped for type-safe retrieval.
func (r *Registry) Get(name string) (any, bool) {
	action, ok := r.actions[name]
	return action, ok
}

// GetTyped retrieves an action implementation with type safety.
// Example: actions := GetTyped[*actions.ProductActions](registry, "product")
func GetTyped[T any](r *Registry, name string) (T, bool) {
	var zero T
	action, ok := r.Get(name)
	if !ok {
		return zero, false
	}
	typed, ok := action.(T)
	return typed, ok
}
