---
phase: 06-hypermedia-ui-generation
plan: 08
type: execute
wave: 3
depends_on: ["06-01", "06-04"]
files_modified:
  - internal/generator/html.go
  - internal/generator/generator.go
  - internal/generator/html_test.go
  - internal/cli/routes.go
autonomous: true

must_haves:
  truths:
    - "GenerateHTML also generates html_register_all.go for HTML route dispatcher"
    - "forge generate orchestrator calls GenerateHTML as part of the pipeline"
    - "forge routes displays HTML routes alongside API routes"
    - "HTML routes shown as GET/POST/PUT/DELETE under /resources path pattern"
  artifacts:
    - path: "internal/generator/generator.go"
      provides: "Updated orchestrator with GenerateHTML"
      contains: "GenerateHTML"
    - path: "internal/cli/routes.go"
      provides: "Updated routes command with htmlRoutes()"
      contains: "htmlRoutes"
  key_links:
    - from: "internal/generator/generator.go"
      to: "internal/generator/html.go"
      via: "orchestrator pipeline"
      pattern: "GenerateHTML"
    - from: "internal/cli/routes.go"
      to: "htmlRoutes"
      via: "routes display"
      pattern: "htmlRoutes"
---

<objective>
Wire HTML generation into orchestrator and add htmlRoutes() to forge routes CLI

Purpose: Complete the generation pipeline by wiring GenerateHTML (with register_all.go) into the forge generate orchestrator, and add htmlRoutes() to the forge routes command so developers can see both API and HTML routes.

Output: Updated orchestrator, updated routes command, generation tests
</objective>

<execution_context>
@/Users/nathananderson-tennant/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathananderson-tennant/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@internal/generator/generator.go
@internal/generator/html.go
@internal/cli/routes.go
@.planning/phases/06-hypermedia-ui-generation/06-01-SUMMARY.md
@.planning/phases/06-hypermedia-ui-generation/06-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update GenerateHTML to also generate html_register_all.go, wire into orchestrator</name>
  <files>
    internal/generator/html.go
    internal/generator/html_test.go
    internal/generator/generator.go
  </files>
  <action>
    Update html.go to add a third generation step:

    After generating primitives.templ and sse.go, GenerateHTML should also:
    - Render html_register_all.go.tmpl with {Resources: resources, ProjectModule: projectModule}
    - Write to gen/html/register_all.go using writeGoFile
    - This generates the RegisterAllHTMLRoutes dispatcher (same pattern as gen/api/register_all.go)

    Update html_test.go:
    - Add assertions to TestGenerateHTML for register_all.go:
      - File exists at gen/html/register_all.go
      - Contains: RegisterAllHTMLRoutes, package html, registry.Get

    Update generator.go:
    - Add GenerateHTML as the 13th generator (after GenerateAPI):
      ```go
      // Generate HTML primitives, SSE helpers, and route registration
      if err := GenerateHTML(resources, cfg.OutputDir, cfg.ProjectModule); err != nil {
          return err
      }
      ```
    - Comment updated to reflect 13 generators total
  </action>
  <verify>
    go test ./internal/generator/ -run TestGenerateHTML -v
    go build ./internal/generator/
    go vet ./internal/generator/
  </verify>
  <done>
    GenerateHTML produces gen/html/primitives/primitives.templ, gen/html/sse/sse.go, and gen/html/register_all.go. Wired as 13th generator in orchestrator pipeline after GenerateAPI.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add htmlRoutes() to forge routes command</name>
  <files>
    internal/cli/routes.go
  </files>
  <action>
    Add htmlRoutes() function following the pattern of apiRoutes():

    func htmlRoutes(resource parser.ResourceIR) []Route:
    - Returns 7 HTML routes per resource:
      - GET /{kebab-plural} (list page) -> operationId "html.list{Plural}"
      - GET /{kebab-plural}/new (new form) -> operationId "html.new{Name}"
      - GET /{kebab-plural}/{id} (detail page) -> operationId "html.get{Name}"
      - GET /{kebab-plural}/{id}/edit (edit form) -> operationId "html.edit{Name}"
      - POST /{kebab-plural} (create via Datastar SSE) -> operationId "html.create{Name}"
      - PUT /{kebab-plural}/{id} (update via Datastar SSE) -> operationId "html.update{Name}"
      - DELETE /{kebab-plural}/{id} (delete via Datastar SSE) -> operationId "html.delete{Name}"
    - Note: HTML routes do NOT have /api/v1/ prefix â€” they're at the root path

    Update runRoutes():
    - After collecting apiRoutes per resource, also collect htmlRoutes
    - Display in separate sections: "API Routes" and "HTML Routes" (or "API" and "HTML" headers)
    - Both sections use the same lipgloss color-coding for HTTP methods
    - Update total count to include both API and HTML routes

    The Phase 5 apiRoutes() separation was specifically designed for this addition (05-04 decision: "apiRoutes() separated from runRoutes() so Phase 6 can add htmlRoutes()").
  </action>
  <verify>
    go build ./
    go vet ./internal/cli/
  </verify>
  <done>
    forge routes displays both API routes (/api/v1/...) and HTML routes (/...) for each resource. 7 HTML routes per resource shown alongside 5 API routes. Both sections use lipgloss color-coding.
  </done>
</task>

</tasks>

<verification>
- go test ./internal/generator/ -run TestGenerateHTML -v passes
- go build ./ compiles cleanly
- go vet ./internal/cli/ reports no issues
- generator.go calls GenerateHTML as 13th generator after GenerateAPI
- Generated register_all.go contains RegisterAllHTMLRoutes dispatcher
- forge routes shows both API (5 routes) and HTML (7 routes) per resource
- HTML routes use root path pattern (no /api/v1/ prefix)
- All existing tests pass (no regressions)
</verification>

<success_criteria>
- Orchestrator produces complete gen/html/ directory (primitives + sse + register_all)
- forge routes command shows unified view of all routes (API + HTML)
- Phase 5 design intent fulfilled: htmlRoutes() added to same forge routes output
</success_criteria>

<output>
After completion, create `.planning/phases/06-hypermedia-ui-generation/06-08-SUMMARY.md`
</output>
