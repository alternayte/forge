// Code generated by forge generate. DO NOT EDIT.

package errors

import (
	"database/sql"
	"errors"

	"github.com/jackc/pgx/v5/pgconn"
)

// PostgreSQL error codes
const (
	ErrCodeUniqueViolation   = "23505"
	ErrCodeFKViolation       = "23503"
	ErrCodeNotNullViolation  = "23502"
	ErrCodeCheckViolation    = "23514"
)

// MapDBError maps PostgreSQL errors to structured forge errors.
func MapDBError(err error) error {
	if err == nil {
		return nil
	}

	// Check for pgx PostgreSQL error
	var pgErr *pgconn.PgError
	if errors.As(err, &pgErr) {
		switch pgErr.Code {
		case ErrCodeUniqueViolation:
			// Extract field name from constraint name if possible
			field := pgErr.ConstraintName
			return UniqueViolation(field)

		case ErrCodeFKViolation:
			// Foreign key violation
			field := pgErr.ConstraintName
			return ForeignKeyViolation(field)

		case ErrCodeNotNullViolation:
			// Not null constraint violation
			field := pgErr.ColumnName
			return &Error{
				Status:  400,
				Code:    "bad_request",
				Message: "Required field is missing",
				Detail:  field,
			}

		case ErrCodeCheckViolation:
			// Check constraint violation
			constraint := pgErr.ConstraintName
			return &Error{
				Status:  400,
				Code:    "bad_request",
				Message: "Value does not meet constraints",
				Detail:  constraint,
			}
		}
	}

	// Default: wrap as internal error
	return InternalError(err)
}

// IsNotFound checks if an error is a sql.ErrNoRows error.
func IsNotFound(err error) bool {
	return errors.Is(err, sql.ErrNoRows)
}
