---
phase: 06-hypermedia-ui-generation
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - internal/generator/templates/scaffold_form.templ.tmpl
  - internal/generator/templates/scaffold_list.templ.tmpl
  - internal/generator/templates/scaffold_detail.templ.tmpl
autonomous: true

must_haves:
  truths:
    - "Scaffold form template renders Datastar-native form with data-bind inputs per field"
    - "Scaffold list template renders table with sort headers, filter controls, and pagination"
    - "Scaffold detail template renders read-only view of all resource fields"
    - "Form template displays field-level validation errors from the action layer"
    - "Form template accepts role parameter for future Phase 7 visibility/mutability checks"
  artifacts:
    - path: "internal/generator/templates/scaffold_form.templ.tmpl"
      provides: "Templ form scaffold template"
      contains: "data-on:submit"
    - path: "internal/generator/templates/scaffold_list.templ.tmpl"
      provides: "Templ list scaffold template"
      contains: "table"
    - path: "internal/generator/templates/scaffold_detail.templ.tmpl"
      provides: "Templ detail scaffold template"
      contains: "templ"
  key_links:
    - from: "scaffold_form.templ.tmpl"
      to: "gen/html/primitives"
      via: "templ import"
      pattern: "primitives\\.TextInput|primitives\\.FormField"
    - from: "scaffold_list.templ.tmpl"
      to: "gen/models"
      via: "typed model parameter"
      pattern: "models\\."
---

<objective>
Create templ scaffold templates for form, list, and detail views

Purpose: Define the Go text/template files that will render into resources/<name>/views/form.templ, list.templ, and detail.templ when `forge generate resource <name>` is run. These templates are scaffold-once files that developers own and customize after generation.

Output: Three scaffold template files that produce Templ components with Datastar interactivity
</objective>

<execution_context>
@/Users/nathananderson-tennant/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathananderson-tennant/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@internal/generator/funcmap.go
@internal/parser/ir.go
@.planning/phases/06-hypermedia-ui-generation/06-RESEARCH.md
@.planning/phases/06-hypermedia-ui-generation/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create scaffold form and detail templ templates</name>
  <files>
    internal/generator/templates/scaffold_form.templ.tmpl
    internal/generator/templates/scaffold_detail.templ.tmpl
  </files>
  <action>
    Create scaffold_form.templ.tmpl that renders a Templ file for resources/<name>/views/form.templ.

    The template receives data with {Resource: parser.ResourceIR, ProjectModule: string}.

    Generated form.templ must contain:

    1. Package declaration: `package views`

    2. Imports: models from {{.ProjectModule}}/gen/models, primitives from {{.ProjectModule}}/gen/html/primitives

    3. Component signature: `templ {{.Resource.Name}}Form({{lower .Resource.Name}} *models.{{.Resource.Name}}, errors map[string]string, role string)`
       - The role parameter is for Phase 7 visibility/mutability (HTML-07). In Phase 6, render all fields regardless of role.

    4. Form element with:
       - Wrapper div with id="{{lower .Resource.Name}}-form"
       - data-on:submit__prevent attribute calling datastar.PostSSE for the resource URL
       - data-signals attribute initializing signals from the model fields

    5. For each non-ID field in .Resource.Fields (skip ID fields using isIDField):
       - Render a FormField wrapper with label (use field Name), field name (use snake of field Name), and errors[snake(field.Name)]
       - Inside FormField, render the appropriate input based on field type:
         - String, Text, Slug, Email, URL: @primitives.TextInput with data-bind
         - Decimal: @primitives.DecimalInput
         - Int, BigInt: primitives.TextInput with type number (or inline input with type="number")
         - Bool: checkbox input with data-bind
         - Enum: @primitives.SelectInput with options from field.EnumValues
         - Date, DateTime: input with type="date" or "datetime-local" and data-bind

    6. Submit button with Tailwind styling (bg-blue-600, text-white, px-4, py-2, rounded, hover:bg-blue-700)

    Important: Since .templ files use `{` for both Go template and Templ syntax, use `{{"{{"}}` or similar escaping where needed. The outer template engine is Go text/template; the inner output is Templ syntax. Templ uses { } for expressions. Go text/template uses {{ }}. Literal braces in the output that Templ needs must be passed through.

    Create scaffold_detail.templ.tmpl that renders resources/<name>/views/detail.templ:

    1. Package: `package views`
    2. Imports: models from {{.ProjectModule}}/gen/models
    3. Component: `templ {{.Resource.Name}}Detail({{lower .Resource.Name}} *models.{{.Resource.Name}})`
    4. A read-only display of all fields in a definition list (dl/dt/dd) layout:
       - For each field (including ID): dt with field Name as label, dd with the field value expression
       - Tailwind classes for spacing and typography
    5. Action buttons at bottom: Edit link, Back to list link
  </action>
  <verify>
    go build ./internal/generator/
  </verify>
  <done>
    scaffold_form.templ.tmpl generates Datastar-native form with data-bind inputs per field, field-level error display, role parameter, and import of primitives. scaffold_detail.templ.tmpl generates read-only detail view with definition list layout.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create scaffold list templ template</name>
  <files>
    internal/generator/templates/scaffold_list.templ.tmpl
  </files>
  <action>
    Create scaffold_list.templ.tmpl that renders resources/<name>/views/list.templ.

    The template receives data with {Resource: parser.ResourceIR, ProjectModule: string}.

    Generated list.templ must contain:

    1. Package: `package views`
    2. Imports: models from {{.ProjectModule}}/gen/models, fmt for URL formatting

    3. Component: `templ {{.Resource.Name}}List({{lower .Resource.Name | plural}} []models.{{.Resource.Name}}, currentSort string, currentDir string, page int, totalPages int)`

    4. Table with Tailwind styling (w-full, border-collapse):
       a. thead with tr containing th elements for each field:
          - For sortable fields (isSortable check): th is a clickable sort header that sets data-signals for sort field and direction. Include an arrow indicator showing current sort direction.
          - For non-sortable fields: plain th with field name
          - Last th: "Actions" column

       b. tbody with a for-range loop over the items:
          - For each item, a tr with td for each field value
          - Actions td with View and Edit links pointing to /{kebab-plural}/{id} and /{kebab-plural}/{id}/edit

    5. Filter controls section above the table:
       - For each filterable field (isFilterable check): render an input with data-bind for filter signal
       - A "Filter" button that triggers a GET request to reload the list

    6. Pagination section below the table:
       - Previous/Next links
       - Page N of M display
       - Use simple offset-based pagination for HTML (cursor-based is for API)

    7. "New {{.Resource.Name}}" button at top linking to /{kebab-plural}/new

    All interactive elements use Datastar data-on:click attributes with SSE GET requests for sorting and filtering, so the page re-renders server-side without full page reload.
  </action>
  <verify>
    go build ./internal/generator/
  </verify>
  <done>
    scaffold_list.templ.tmpl generates table with sort headers (for Sortable fields), filter controls (for Filterable fields), offset-based pagination, and New/View/Edit action links. All interactive elements use Datastar SSE for server-side re-rendering.
  </done>
</task>

</tasks>

<verification>
- go build ./internal/generator/ compiles cleanly (templates parse correctly)
- scaffold_form.templ.tmpl contains: templ signature with role parameter, data-on:submit, data-bind, data-signals, FormField, primitives import, errors map
- scaffold_list.templ.tmpl contains: table, thead, tbody, sort header logic, filter inputs, pagination, New button
- scaffold_detail.templ.tmpl contains: templ signature, dl/dt/dd layout, Edit link, Back link
- All templates iterate over .Resource.Fields and skip ID for form inputs
- Form template imports primitives from gen/html/primitives
</verification>

<success_criteria>
- GEN-09 partially satisfied: Templ form, list, and detail scaffold templates ready
- HTML-01 satisfied: Form renders Datastar-native with validation error display
- HTML-02 satisfied: List renders with sort headers, filter controls, pagination
- HTML-03 satisfied: Detail renders read-only resource view
- HTML-06 satisfied: Form displays field-level validation errors from action layer
- HTML-07 scaffolded: Form accepts role parameter (actual visibility logic deferred to Phase 7)
</success_criteria>

<output>
After completion, create `.planning/phases/06-hypermedia-ui-generation/06-03-SUMMARY.md`
</output>
