---
phase: 01-foundation-schema-dsl
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - go.mod
  - go.sum
  - internal/schema/field.go
  - internal/schema/field_type.go
  - internal/schema/modifier.go
  - internal/schema/relationship.go
  - internal/schema/option.go
  - internal/schema/definition.go
  - internal/schema/schema.go
autonomous: true

must_haves:
  truths:
    - "Developer can define a resource with all 14 field types using fluent method chaining"
    - "Developer can apply all field modifiers (Required, MaxLen, MinLen, etc.) via chaining"
    - "Developer can define BelongsTo, HasMany, HasOne, ManyToMany relationships inline alongside fields"
    - "Developer can enable SoftDelete, Auditable, TenantScoped, Searchable options per resource"
    - "Developer can call Timestamps() to auto-add created_at and updated_at"
    - "Developer can define Enum fields with specific allowed values and a Default"
    - "schema.Define() takes variadic args with fields, relationships, and options at the same level"
  artifacts:
    - path: "internal/schema/field.go"
      provides: "Field struct with fluent modifier methods"
      contains: "func (f *Field) Required() *Field"
    - path: "internal/schema/field_type.go"
      provides: "Constructor functions for all 14 field types"
      contains: "func String(name string) *Field"
    - path: "internal/schema/modifier.go"
      provides: "Modifier types and constants"
      contains: "ModifierRequired"
    - path: "internal/schema/relationship.go"
      provides: "Relationship types with fluent API"
      contains: "func BelongsTo(name, table string) *Relationship"
    - path: "internal/schema/option.go"
      provides: "Resource-level options"
      contains: "func SoftDelete()"
    - path: "internal/schema/definition.go"
      provides: "Define function and Definition type"
      contains: "func Define(name string, items ...SchemaItem) *Definition"
    - path: "internal/schema/schema.go"
      provides: "Package documentation and SchemaItem interface"
      contains: "type SchemaItem interface"
  key_links:
    - from: "internal/schema/field.go"
      to: "internal/schema/definition.go"
      via: "Field implements SchemaItem interface"
      pattern: "func \\(f \\*Field\\) schemaItem\\(\\)"
    - from: "internal/schema/relationship.go"
      to: "internal/schema/definition.go"
      via: "Relationship implements SchemaItem interface"
      pattern: "func \\(r \\*Relationship\\) schemaItem\\(\\)"
---

<objective>
Create the schema definition DSL package that developers use to define resource schemas with fluent method chaining. This is the public API surface that all schema.go files in resources/ directories will use.

Purpose: The schema package is the foundation of Forge's "schema as single source of truth" philosophy. It must be importable and usable by developer-authored schema files, with all definitions parseable by go/ast without requiring gen/ to exist.

Output: `internal/schema/` package with field types, modifiers, relationships, options, and the Define() function.
</objective>

<execution_context>
@/Users/nathananderson-tennant/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathananderson-tennant/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-schema-dsl/01-CONTEXT.md
@.planning/phases/01-foundation-schema-dsl/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Go module and create schema type foundations</name>
  <files>
    go.mod
    internal/schema/schema.go
    internal/schema/field_type.go
    internal/schema/modifier.go
    internal/schema/field.go
  </files>
  <action>
Initialize Go module as `github.com/forge-framework/forge` with Go 1.23+. No external dependencies yet (this plan is pure Go stdlib).

Create `internal/schema/schema.go` as the package entry point:
- Define `SchemaItem` interface with unexported marker method `schemaItem()` — this is the common type for variadic args to Define(). Fields, relationships, options, and timestamps all implement it.
- Define `FieldType` enum type (int) with constants: TypeUUID, TypeString, TypeText, TypeInt, TypeBigInt, TypeDecimal, TypeBool, TypeDateTime, TypeDate, TypeEnum, TypeJSON, TypeSlug, TypeEmail, TypeURL (14 types per SCHEMA-01).
- Define `OnDeleteAction` enum type: Cascade, SetNull, Restrict, NoAction.
- Add `String()` method on FieldType for debugging.

Create `internal/schema/field_type.go` with constructor functions for each field type:
- `UUID(name string) *Field`, `String(name string) *Field`, `Text(name string) *Field`, `Int(name string) *Field`, `BigInt(name string) *Field`, `Decimal(name string) *Field`, `Bool(name string) *Field`, `DateTime(name string) *Field`, `Date(name string) *Field`, `Enum(name string, values ...string) *Field`, `JSON(name string) *Field`, `Slug(name string) *Field`, `Email(name string) *Field`, `URL(name string) *Field`
- Each returns `*Field` with the appropriate FieldType set and name stored.
- `Enum()` additionally stores the allowed values list on the Field.

Create `internal/schema/modifier.go`:
- Define `ModifierType` enum: ModRequired, ModMaxLen, ModMinLen, ModSortable, ModFilterable, ModSearchable, ModUnique, ModIndex, ModDefault, ModImmutable, ModLabel, ModPlaceholder, ModHelp, ModPrimaryKey, ModOptional.
- Define `Modifier` struct: `Type ModifierType`, `Value interface{}` (for MaxLen int, Default string, etc.).

Create `internal/schema/field.go` with the `Field` struct and fluent methods:
- Field struct: `name string`, `fieldType FieldType`, `modifiers []Modifier`, `enumValues []string` (for Enum type), exported getters: `Name() string`, `Type() FieldType`, `Modifiers() []Modifier`, `EnumValues() []string`.
- Fluent modifier methods (each returns `*Field` for chaining):
  - `Required()`, `Optional()`, `PrimaryKey()`
  - `MaxLen(n int)`, `MinLen(n int)`
  - `Sortable()`, `Filterable()`, `Searchable()`
  - `Unique()`, `Index()`
  - `Default(v interface{})`, `Immutable()`
  - `Label(s string)`, `Placeholder(s string)`, `Help(s string)`
- Field implements `SchemaItem` via `schemaItem()` unexported method.

Per user decision: fluent method chaining style like `schema.String("Title").Required().MaxLen(200)`.
  </action>
  <verify>
    Run `cd /Users/nathananderson-tennant/Development/forge-go && go build ./internal/schema/` — must compile with zero errors. Verify all 14 field type constructors exist. Verify Field has all modifier methods returning *Field.
  </verify>
  <done>Go module initialized. Field struct with 14 type constructors and all modifier methods compiles. SchemaItem interface defined. Fluent chaining works: `schema.String("Title").Required().MaxLen(200)` is valid Go.</done>
</task>

<task type="auto">
  <name>Task 2: Create relationships, options, timestamps, and Define function</name>
  <files>
    internal/schema/relationship.go
    internal/schema/option.go
    internal/schema/definition.go
  </files>
  <action>
Create `internal/schema/relationship.go`:
- `Relationship` struct: `name string`, `relType RelationType`, `table string`, `onDelete OnDeleteAction`, `modifiers []Modifier` (for Optional, etc.).
- `RelationType` enum: RelBelongsTo, RelHasMany, RelHasOne, RelManyToMany.
- Constructor functions returning `*Relationship`:
  - `BelongsTo(name, table string) *Relationship`
  - `HasMany(name, table string) *Relationship`
  - `HasOne(name, table string) *Relationship`
  - `ManyToMany(name, table string) *Relationship`
- Fluent methods on `*Relationship`: `Optional() *Relationship`, `OnDelete(action OnDeleteAction) *Relationship`.
- Exported getters: `Name()`, `RelType()`, `Table()`, `OnDeleteAction()`, `IsOptional()`.
- Relationship implements `SchemaItem` via `schemaItem()`.

Per user decision: relationships inline alongside fields — `schema.BelongsTo("Category", "categories").Optional().OnDelete(schema.SetNull)`.

Create `internal/schema/option.go`:
- `Option` struct: `optionType OptionType`.
- `OptionType` enum: OptSoftDelete, OptAuditable, OptTenantScoped, OptSearchable.
- Constructor functions returning `*Option` (each implements SchemaItem):
  - `SoftDelete() *Option`
  - `Auditable() *Option`
  - `TenantScoped() *Option`
  - `Searchable() *Option`
- `Timestamps()` function returning a `*TimestampsItem` that implements SchemaItem. This signals that created_at and updated_at fields should be auto-added.
- Exported getter: `Type() OptionType`.

Create `internal/schema/definition.go`:
- `Definition` struct with exported getters:
  - `name string` + `Name() string`
  - `fields []*Field` + `Fields() []*Field`
  - `relationships []*Relationship` + `Relationships() []*Relationship`
  - `options []*Option` + `Options() []*Option`
  - `hasTimestamps bool` + `HasTimestamps() bool`
- `Define(name string, items ...SchemaItem) *Definition` function:
  - Iterates items, type-switches on `*Field`, `*Relationship`, `*Option`, `*TimestampsItem`.
  - Categorizes each into the appropriate slice on Definition.
  - Returns populated `*Definition`.
  - This function exists so developer code compiles, but the AST parser extracts definitions statically — Define() is never called at parse time.

Per user decision: `schema.Define()` takes variadic args — fields, relationships, timestamps all at same level in flat list.

The final usage should look like:
```go
var Product = schema.Define("Product",
    schema.SoftDelete(),
    schema.UUID("ID").PrimaryKey(),
    schema.String("Title").Required().MaxLen(200).Label("Product Title"),
    schema.Text("Description").Help("Full product description"),
    schema.Decimal("Price").Required().Filterable().Sortable(),
    schema.Enum("Status", "draft", "published", "archived").Default("draft"),
    schema.Bool("Featured").Default(false),
    schema.BelongsTo("Category", "categories").Optional().OnDelete(schema.SetNull),
    schema.HasMany("Reviews", "reviews"),
    schema.Timestamps(),
)
```
  </action>
  <verify>
    Run `cd /Users/nathananderson-tennant/Development/forge-go && go build ./internal/schema/` — must compile. Write a brief test file `internal/schema/schema_test.go` that creates a Definition matching the Product example above and asserts: field count, relationship count, option count, hasTimestamps. Run `go test ./internal/schema/`.
  </verify>
  <done>Define() function works with variadic SchemaItem args. Relationships support fluent chaining with Optional() and OnDelete(). All 4 resource options (SoftDelete, Auditable, TenantScoped, Searchable) exist. Timestamps() works. A test proves the full Product example schema compiles and populates Definition correctly.</done>
</task>

</tasks>

<verification>
- `go build ./internal/schema/` compiles with zero errors
- `go test ./internal/schema/` passes
- All 14 field types have constructor functions
- All modifiers are chainable and return *Field
- All 4 relationship types have constructors with fluent OnDelete/Optional
- Define() correctly categorizes fields, relationships, options, and timestamps
- The example Product schema from CONTEXT.md is valid Go that compiles
</verification>

<success_criteria>
A developer can write `var Product = schema.Define("Product", schema.String("Title").Required().MaxLen(200), schema.BelongsTo("Category", "categories").OnDelete(schema.SetNull), schema.Timestamps())` and it compiles. The Definition struct correctly categorizes all items. All 14 field types, all modifiers, all relationship types, all options, and Timestamps are available.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-schema-dsl/01-01-SUMMARY.md`
</output>
