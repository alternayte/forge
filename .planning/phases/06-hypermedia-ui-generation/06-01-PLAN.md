---
phase: 06-hypermedia-ui-generation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/generator/templates/html_primitives.templ.tmpl
  - internal/generator/templates/html_sse.go.tmpl
  - internal/generator/html.go
  - internal/generator/html_test.go
  - internal/generator/funcmap.go
autonomous: true

must_haves:
  truths:
    - "Generated gen/html/primitives/ contains FormField, TextInput, DecimalInput, SelectInput, RelationSelect templ components"
    - "Generated gen/html/sse/ contains MergeFragment and Redirect helper functions"
    - "Primitives display field-level validation errors when error string is non-empty"
  artifacts:
    - path: "internal/generator/templates/html_primitives.templ.tmpl"
      provides: "Templ component primitives template"
      contains: "FormField"
    - path: "internal/generator/templates/html_sse.go.tmpl"
      provides: "Datastar SSE helper functions template"
      contains: "MergeFragment"
    - path: "internal/generator/html.go"
      provides: "GenerateHTML function for primitives and SSE"
      exports: ["GenerateHTML"]
    - path: "internal/generator/html_test.go"
      provides: "Tests for HTML generation"
      contains: "TestGenerateHTML"
  key_links:
    - from: "internal/generator/html.go"
      to: "internal/generator/templates/html_primitives.templ.tmpl"
      via: "renderTemplate"
      pattern: "renderTemplate.*html_primitives"
    - from: "internal/generator/html.go"
      to: "internal/generator/templates/html_sse.go.tmpl"
      via: "renderTemplate"
      pattern: "renderTemplate.*html_sse"
---

<objective>
Generate form primitives library and Datastar SSE helpers into gen/html/

Purpose: Provide reusable templ components (FormField, TextInput, DecimalInput, SelectInput, RelationSelect) and SSE helper functions (MergeFragment, Redirect) that all scaffolded resource views will import. These are generated-always files in gen/ (not scaffolded-once).

Output: GenerateHTML function, two templates, tests
</objective>

<execution_context>
@/Users/nathananderson-tennant/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nathananderson-tennant/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@internal/generator/generator.go
@internal/generator/funcmap.go
@internal/generator/templates/validation_types.go.tmpl
@.planning/phases/06-hypermedia-ui-generation/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create templ primitives template and SSE helpers template</name>
  <files>
    internal/generator/templates/html_primitives.templ.tmpl
    internal/generator/templates/html_sse.go.tmpl
    internal/generator/funcmap.go
  </files>
  <action>
    Create html_primitives.templ.tmpl that generates gen/html/primitives/primitives.templ with these components:

    1. FormField(label, name, errMsg string) - wrapper div with label, slot-like children pattern, and conditional error message display. When errMsg is non-empty, renders a red text paragraph below the input.

    2. TextInput(name, value, placeholder string) - input element with data-bind:{name} for Datastar signal binding, type="text", Tailwind classes for border/padding/focus ring.

    3. DecimalInput(name, value, placeholder string) - input element with data-bind:{name}, type="number", step="0.01".

    4. SelectInput(name, selected string, options []SelectOption) - select element with data-bind:{name}. SelectOption is a struct{Value, Label string} defined in the same file.

    5. RelationSelect(name, selected string, options []SelectOption) - same as SelectInput but with an empty "-- Select --" first option.

    All components use Tailwind utility classes for styling (border, rounded, px-2, py-1, focus:ring-2, focus:ring-blue-500, etc.). Error states add border-red-500 class.

    The template uses {{.ProjectModule}} for the package path. Package declaration is `package primitives`.

    Create html_sse.go.tmpl that generates gen/html/sse/sse.go with:

    1. MergeFragment(sse *datastar.SSE, component templ.Component) error - calls sse.PatchElementTempl(component). This is a thin wrapper providing a semantic name.

    2. Redirect(sse *datastar.SSE, url string) - calls sse.Redirect(url). Another semantic wrapper.

    3. RedirectTo(sse *datastar.SSE, format string, args ...any) - calls sse.Redirectf(format, args...). Printf-style convenience.

    The template imports github.com/starfederation/datastar-go/datastar and github.com/a-h/templ. Package declaration is `package sse`.

    Add a funcmap helper `htmlInputType` to funcmap.go that maps field types to HTML input types: String->"text", Text->"text", Int->"number", BigInt->"number", Decimal->"number", Bool->"checkbox", Email->"email", URL->"url", Date->"date", DateTime->"datetime-local". Default to "text".
  </action>
  <verify>
    go build ./internal/generator/
    go vet ./internal/generator/
  </verify>
  <done>
    html_primitives.templ.tmpl contains FormField, TextInput, DecimalInput, SelectInput, RelationSelect templ component definitions with Tailwind classes and error display. html_sse.go.tmpl contains MergeFragment, Redirect, RedirectTo wrappers around datastar SDK. htmlInputType helper added to funcmap.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GenerateHTML function and tests</name>
  <files>
    internal/generator/html.go
    internal/generator/html_test.go
  </files>
  <action>
    Create html.go with a GenerateHTML function following the pattern of GenerateMiddleware (semi-static, not per-resource):

    func GenerateHTML(resources []parser.ResourceIR, outputDir, projectModule string) error

    1. Create gen/html/primitives/ directory via ensureDir
    2. Create gen/html/sse/ directory via ensureDir
    3. Render html_primitives.templ.tmpl with {ProjectModule: projectModule} data
    4. Write to gen/html/primitives/primitives.templ using writeRawFile (NOT writeGoFile, since .templ files are not Go files)
    5. Render html_sse.go.tmpl with {ProjectModule: projectModule} data
    6. Write to gen/html/sse/sse.go using writeGoFile (this IS a Go file)

    Create html_test.go with TestGenerateHTML that:
    - Creates a temp directory
    - Calls GenerateHTML with a sample resource and project module "github.com/test/myapp"
    - Verifies gen/html/primitives/primitives.templ exists and contains: FormField, TextInput, DecimalInput, SelectInput, RelationSelect, package primitives, data-bind
    - Verifies gen/html/sse/sse.go exists and contains: MergeFragment, Redirect, RedirectTo, PatchElementTempl, datastar, package sse
    - Follow the exact test pattern from middleware_test.go (read file, check for required strings)
  </action>
  <verify>
    go test ./internal/generator/ -run TestGenerateHTML -v
    go build ./internal/generator/
  </verify>
  <done>
    GenerateHTML produces gen/html/primitives/primitives.templ with 5 form components and gen/html/sse/sse.go with 3 SSE helpers. Tests verify all components and helpers are present.
  </done>
</task>

</tasks>

<verification>
- go test ./internal/generator/ -run TestGenerateHTML -v passes
- go build ./internal/generator/ compiles cleanly
- go vet ./internal/generator/ reports no issues
- Generated primitives.templ contains FormField, TextInput, DecimalInput, SelectInput, RelationSelect
- Generated sse.go contains MergeFragment, Redirect, RedirectTo
- Primitives show error messages when errMsg is non-empty
</verification>

<success_criteria>
- HTML-04 satisfied: FormField, TextInput, DecimalInput, SelectInput, RelationSelect components generated
- HTML-05 satisfied: MergeFragment and Redirect SSE helpers generated
- HTML-06 partially satisfied: Primitives display field-level validation errors
- GenerateHTML function ready to wire into orchestrator
</success_criteria>

<output>
After completion, create `.planning/phases/06-hypermedia-ui-generation/06-01-SUMMARY.md`
</output>
