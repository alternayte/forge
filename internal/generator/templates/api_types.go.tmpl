// Code generated by forge generate. DO NOT EDIT.

package api

import (
	"fmt"
	"log/slog"
	"net/http"

	"github.com/danielgtaylor/huma/v2"
	"{{.ProjectModule}}/gen/errors"
)

// PaginationMeta contains offset-based pagination metadata returned with list responses.
type PaginationMeta struct {
	// Page is the current page number.
	Page int `json:"page" doc:"Current page number"`
	// PageSize is the number of items per page.
	PageSize int `json:"page_size" doc:"Items per page"`
	// TotalCount is the total number of matching items.
	TotalCount int64 `json:"total_count" doc:"Total matching items"`
	// HasMore indicates whether additional results exist beyond the current page.
	HasMore bool `json:"has_more" doc:"Whether more results exist"`
}

// toHumaError converts a forge error to a Huma API error.
// It maps forge.Error status codes to appropriate Huma HTTP error responses,
// including per-field validation details for 422 responses.
func toHumaError(err error) huma.StatusError {
	if err == nil {
		return nil
	}

	var forgeErr *errors.Error
	if fe, ok := err.(*errors.Error); ok {
		forgeErr = fe
	} else {
		// Unknown error type — log and treat as internal server error
		slog.Error("untyped handler error", "err", err)
		return huma.Error500InternalServerError("internal server error")
	}

	// Log server errors with the underlying cause
	if forgeErr.Status >= 500 && forgeErr.Err != nil {
		slog.Error("handler error",
			"status", forgeErr.Status,
			"code", forgeErr.Code,
			"err", forgeErr.Err,
		)
	}

	switch forgeErr.Status {
	case http.StatusNotFound:
		return huma.Error404NotFound(forgeErr.Message)
	case http.StatusConflict:
		return huma.Error409Conflict(forgeErr.Message)
	case http.StatusUnprocessableEntity:
		// Validation error — include detail as error context
		detail := &huma.ErrorDetail{
			Message: forgeErr.Detail,
		}
		return huma.Error422UnprocessableEntity(forgeErr.Message, detail)
	case http.StatusBadRequest:
		return huma.Error400BadRequest(forgeErr.Message)
	case http.StatusUnauthorized:
		return huma.Error401Unauthorized(forgeErr.Message)
	case http.StatusForbidden:
		return huma.Error403Forbidden(forgeErr.Message)
	default:
		return huma.Error500InternalServerError(forgeErr.Message)
	}
}

// buildAPILinkHeader builds an RFC 8288 Link header value for cursor pagination.
// Returns the header string in the format: <{path}?cursor={cursor}&limit={limit}>; rel="next"
func buildAPILinkHeader(basePath string, cursor string, limit int) string {
	return fmt.Sprintf(`<%s?cursor=%s&limit=%d>; rel="next"`, basePath, cursor, limit)
}
